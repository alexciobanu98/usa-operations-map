<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USA Operations Map - Standalone Version</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .map-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        #usa-map {
            width: 100%;
            height: 600px;
        }
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            font-size: 14px;
            z-index: 1000;
            max-width: 250px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }
        .tooltip p {
            margin: 5px 0;
        }
        .tooltip.visible {
            opacity: 1;
        }
        .region-overview {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            padding: 30px;
            z-index: 1001;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
        }
        .region-overview h2 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .region-overview .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #7f8c8d;
        }
        .region-overview .close-btn:hover {
            color: #e74c3c;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .project-card {
            background-color: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            border-left: 4px solid #3498db;
        }
        .project-card h4 {
            margin-top: 0;
            color: #2c3e50;
        }
        .project-card p {
            margin: 5px 0;
            color: #7f8c8d;
        }
        .project-card .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-top: 10px;
        }
        .project-card .status.active {
            background-color: #2ecc71;
            color: white;
        }
        .project-card .status.completed {
            background-color: #95a5a6;
            color: white;
        }
        .metrics-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .metric-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            flex: 1;
            margin: 0 10px;
            text-align: center;
        }
        .metric-card:first-child {
            margin-left: 0;
        }
        .metric-card:last-child {
            margin-right: 0;
        }
        .metric-card h3 {
            margin-top: 0;
            color: #7f8c8d;
            font-size: 16px;
            font-weight: normal;
        }
        .metric-card .value {
            font-size: 36px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        .metric-card .trend {
            font-size: 14px;
            color: #7f8c8d;
        }
        .metric-card .trend.up {
            color: #2ecc71;
        }
        .metric-card .trend.down {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>USA Operations Map</h1>
        
        <div class="metrics-summary">
            <div class="metric-card">
                <h3>Active Projects</h3>
                <div class="value">110</div>
                <div class="trend up">↑ 5% from last month</div>
            </div>
            <div class="metric-card">
                <h3>Total Sites</h3>
                <div class="value">342</div>
                <div class="trend up">↑ 8% from last month</div>
            </div>
            <div class="metric-card">
                <h3>Equipment Deployed</h3>
                <div class="value">1,245</div>
                <div class="trend up">↑ 12% from last month</div>
            </div>
            <div class="metric-card">
                <h3>Completion Rate</h3>
                <div class="value">87%</div>
                <div class="trend up">↑ 3% from last month</div>
            </div>
        </div>
        
        <div class="map-container">
            <div id="usa-map"></div>
        </div>
    </div>
    
    <div id="tooltip" class="tooltip"></div>
    
    <div id="overlay" class="overlay"></div>
    
    <div id="regionOverview" class="region-overview">
        <button class="close-btn" onclick="closeRegionOverview()">×</button>
        <h2 id="regionTitle">Region Overview</h2>
        <div id="regionSummary"></div>
        <div id="projectsGrid" class="project-grid"></div>
    </div>
    
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <script>
        // Region definitions with colors
        const regions = {
            pnw: {
                name: "Pacific Northwest",
                color: "#3498db",
                states: ["WA", "OR", "ID", "MT", "WY"]
            },
            midwest: {
                name: "Midwest",
                color: "#2ecc71",
                states: ["ND", "SD", "NE", "KS", "MN", "IA", "MO", "WI", "IL", "IN", "MI", "OH"]
            },
            northeast: {
                name: "Northeast",
                color: "#9b59b6",
                states: ["ME", "NH", "VT", "MA", "RI", "CT", "NY", "PA", "NJ", "DE", "MD"]
            },
            southeast: {
                name: "Southeast",
                color: "#e74c3c",
                states: ["VA", "WV", "KY", "NC", "SC", "TN", "GA", "FL", "AL", "MS", "AR", "LA"]
            },
            southwest: {
                name: "Southwest",
                color: "#f39c12",
                states: ["TX", "OK", "NM", "AZ", "CO", "UT", "NV"]
            },
            west: {
                name: "West",
                color: "#1abc9c",
                states: ["CA", "HI", "AK"]
            }
        };

        // Mock data for regions
        const regionData = {
            pnw: {
                totalProjects: 24,
                activeProjects: 18,
                completedProjects: 6,
                totalSites: 78,
                activeSites: 52,
                equipmentDeployed: 245,
                projects: [
                    { id: 1, name: "Seattle Tower Expansion", status: "active", completion: 65, sites: 8, equipment: 32 },
                    { id: 2, name: "Portland Metro Coverage", status: "active", completion: 42, sites: 12, equipment: 48 },
                    { id: 3, name: "Boise Network Upgrade", status: "completed", completion: 100, sites: 6, equipment: 24 }
                ]
            },
            midwest: {
                totalProjects: 45,
                activeProjects: 32,
                completedProjects: 13,
                totalSites: 124,
                activeSites: 86,
                equipmentDeployed: 372,
                projects: [
                    { id: 4, name: "Chicago Urban Densification", status: "active", completion: 78, sites: 15, equipment: 60 },
                    { id: 5, name: "Minneapolis-St. Paul Expansion", status: "active", completion: 54, sites: 10, equipment: 40 },
                    { id: 6, name: "Detroit Coverage Enhancement", status: "completed", completion: 100, sites: 8, equipment: 32 }
                ]
            },
            northeast: {
                totalProjects: 36,
                activeProjects: 22,
                completedProjects: 14,
                totalSites: 92,
                activeSites: 64,
                equipmentDeployed: 276,
                projects: [
                    { id: 7, name: "NYC High Capacity Upgrade", status: "active", completion: 82, sites: 18, equipment: 72 },
                    { id: 8, name: "Boston Harbor Coverage", status: "active", completion: 46, sites: 7, equipment: 28 },
                    { id: 9, name: "Philadelphia Suburban Expansion", status: "completed", completion: 100, sites: 9, equipment: 36 }
                ]
            },
            southeast: {
                totalProjects: 52,
                activeProjects: 38,
                completedProjects: 14,
                totalSites: 148,
                activeSites: 102,
                equipmentDeployed: 444,
                projects: [
                    { id: 10, name: "Atlanta Metro Upgrade", status: "active", completion: 72, sites: 14, equipment: 56 },
                    { id: 11, name: "Florida Coastal Coverage", status: "active", completion: 58, sites: 22, equipment: 88 },
                    { id: 12, name: "Nashville Network Expansion", status: "completed", completion: 100, sites: 8, equipment: 32 }
                ]
            },
            southwest: {
                totalProjects: 38,
                activeProjects: 28,
                completedProjects: 10,
                totalSites: 112,
                activeSites: 76,
                equipmentDeployed: 336,
                projects: [
                    { id: 13, name: "Texas Urban Triangle", status: "active", completion: 68, sites: 24, equipment: 96 },
                    { id: 14, name: "Phoenix Metro Coverage", status: "active", completion: 52, sites: 10, equipment: 40 },
                    { id: 15, name: "Denver Capacity Expansion", status: "completed", completion: 100, sites: 12, equipment: 48 }
                ]
            },
            west: {
                totalProjects: 42,
                activeProjects: 32,
                completedProjects: 10,
                totalSites: 128,
                activeSites: 88,
                equipmentDeployed: 384,
                projects: [
                    { id: 16, name: "Bay Area Densification", status: "active", completion: 76, sites: 20, equipment: 80 },
                    { id: 17, name: "Los Angeles Upgrade", status: "active", completion: 64, sites: 18, equipment: 72 },
                    { id: 18, name: "San Diego Coverage Extension", status: "completed", completion: 100, sites: 10, equipment: 40 }
                ]
            }
        };

        // State abbreviations mapping
        const stateAbbreviations = {
            "Alabama": "AL", "Alaska": "AK", "Arizona": "AZ", "Arkansas": "AR", "California": "CA",
            "Colorado": "CO", "Connecticut": "CT", "Delaware": "DE", "Florida": "FL", "Georgia": "GA",
            "Hawaii": "HI", "Idaho": "ID", "Illinois": "IL", "Indiana": "IN", "Iowa": "IA",
            "Kansas": "KS", "Kentucky": "KY", "Louisiana": "LA", "Maine": "ME", "Maryland": "MD",
            "Massachusetts": "MA", "Michigan": "MI", "Minnesota": "MN", "Mississippi": "MS", "Missouri": "MO",
            "Montana": "MT", "Nebraska": "NE", "Nevada": "NV", "New Hampshire": "NH", "New Jersey": "NJ",
            "New Mexico": "NM", "New York": "NY", "North Carolina": "NC", "North Dakota": "ND", "Ohio": "OH",
            "Oklahoma": "OK", "Oregon": "OR", "Pennsylvania": "PA", "Rhode Island": "RI", "South Carolina": "SC",
            "South Dakota": "SD", "Tennessee": "TN", "Texas": "TX", "Utah": "UT", "Vermont": "VT",
            "Virginia": "VA", "Washington": "WA", "West Virginia": "WV", "Wisconsin": "WI", "Wyoming": "WY"
        };

        // Function to get state abbreviation from id
        function getStateAbbr(id, stateNames) {
            const stateName = stateNames.get(id);
            return stateAbbreviations[stateName] || "";
        }

        // Function to get region color for state
        function getRegionColor(stateAbbr) {
            for (const regionId in regions) {
                if (regions[regionId].states.includes(stateAbbr)) {
                    return regions[regionId].color;
                }
            }
            return "#ccc"; // Default color for states not in any region
        }

        // Function to get tooltip info for state
        function getStateTooltipInfo(stateAbbr) {
            for (const regionId in regions) {
                if (regions[regionId].states.includes(stateAbbr)) {
                    const region = regions[regionId];
                    const data = regionData[regionId];
                    return {
                        region: region.name,
                        projects: data.totalProjects,
                        active: data.activeProjects,
                        sites: data.totalSites
                    };
                }
            }
            return null;
        }

        // Function to get region ID for state
        function getRegionForState(stateAbbr) {
            for (const regionId in regions) {
                if (regions[regionId].states.includes(stateAbbr)) {
                    return regionId;
                }
            }
            return null;
        }

        // Function to check if state is in any region
        function isStateInRegions(stateAbbr) {
            for (const regionId in regions) {
                if (regions[regionId].states.includes(stateAbbr)) {
                    return true;
                }
            }
            return false;
        }

        // Initialize map
        function initializeMap() {
            const width = document.getElementById('usa-map').clientWidth;
            const height = 600;
            
            const svg = d3.select("#usa-map")
                .append("svg")
                .attr("viewBox", `0 0 ${width} ${height}`)
                .attr("preserveAspectRatio", "xMidYMid meet");
                
            const projection = d3.geoAlbersUsa()
                .translate([width / 2, height / 2])
                .scale(width);
                
            const path = d3.geoPath()
                .projection(projection);
                
            const tooltip = d3.select("#tooltip");
            
            // Load US map data
            d3.json("https://cdn.jsdelivr.net/npm/us-atlas@3/states-10m.json").then(us => {
                // Convert TopoJSON to GeoJSON
                const states = topojson.feature(us, us.objects.states);
                
                // Get state name mapping
                const stateNames = new Map(us.objects.states.geometries.map(d => [d.id, d.properties.name]));
                
                // Draw states
                svg.append("g")
                    .selectAll("path")
                    .data(states.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("fill", d => {
                        const stateAbbr = getStateAbbr(d.id, stateNames);
                        return getRegionColor(stateAbbr);
                    })
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 0.5)
                    .attr("class", d => {
                        const stateAbbr = getStateAbbr(d.id, stateNames);
                        return isStateInRegions(stateAbbr) ? "state active" : "state";
                    })
                    .on("mouseover", function(event, d) {
                        const stateAbbr = getStateAbbr(d.id, stateNames);
                        const info = getStateTooltipInfo(stateAbbr);
                        
                        if (info) {
                            tooltip.html(`
                                <h4>${stateNames.get(d.id)} (${stateAbbr})</h4>
                                <p><strong>Region:</strong> ${info.region}</p>
                                <p><strong>Total Projects:</strong> ${info.projects}</p>
                                <p><strong>Active Projects:</strong> ${info.active}</p>
                                <p><strong>Total Sites:</strong> ${info.sites}</p>
                            `)
                            .style("left", (event.pageX + 15) + "px")
                            .style("top", (event.pageY - 28) + "px")
                            .classed("visible", true);
                            
                            d3.select(this)
                                .attr("stroke", "#000")
                                .attr("stroke-width", 1.5);
                        }
                    })
                    .on("mouseout", function() {
                        tooltip.classed("visible", false);
                        
                        d3.select(this)
                            .attr("stroke", "#fff")
                            .attr("stroke-width", 0.5);
                    })
                    .on("click", function(event, d) {
                        const stateAbbr = getStateAbbr(d.id, stateNames);
                        const regionId = getRegionForState(stateAbbr);
                        
                        if (regionId) {
                            showRegionOverview(regionId);
                        }
                    });
            });
        }

        // Show region overview
        function showRegionOverview(regionId) {
            const region = regions[regionId];
            const data = regionData[regionId];
            
            document.getElementById('regionTitle').textContent = region.name + " Region";
            
            // Create region summary
            const summary = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 10px; background-color: ${region.color}22; border-radius: 6px; flex: 1; margin-right: 10px;">
                        <h3 style="margin-top: 0; color: ${region.color};">Projects</h3>
                        <div style="font-size: 24px; font-weight: bold;">${data.totalProjects}</div>
                        <div>${data.activeProjects} Active / ${data.completedProjects} Completed</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background-color: ${region.color}22; border-radius: 6px; flex: 1; margin-right: 10px;">
                        <h3 style="margin-top: 0; color: ${region.color};">Sites</h3>
                        <div style="font-size: 24px; font-weight: bold;">${data.totalSites}</div>
                        <div>${data.activeSites} Active Sites</div>
                    </div>
                    <div style="text-align: center; padding: 10px; background-color: ${region.color}22; border-radius: 6px; flex: 1;">
                        <h3 style="margin-top: 0; color: ${region.color};">Equipment</h3>
                        <div style="font-size: 24px; font-weight: bold;">${data.equipmentDeployed}</div>
                        <div>Units Deployed</div>
                    </div>
                </div>
            `;
            
            document.getElementById('regionSummary').innerHTML = summary;
            
            // Create project cards
            let projectsHTML = '';
            data.projects.forEach(project => {
                projectsHTML += `
                    <div class="project-card">
                        <h4>${project.name}</h4>
                        <p><strong>Completion:</strong> ${project.completion}%</p>
                        <p><strong>Sites:</strong> ${project.sites}</p>
                        <p><strong>Equipment:</strong> ${project.equipment} units</p>
                        <span class="status ${project.status}">${project.status.charAt(0).toUpperCase() + project.status.slice(1)}</span>
                    </div>
                `;
            });
            
            document.getElementById('projectsGrid').innerHTML = projectsHTML;
            
            // Show overlay and region overview
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('regionOverview').style.display = 'block';
        }

        // Close region overview
        function closeRegionOverview() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('regionOverview').style.display = 'none';
        }

        // Initialize map when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeMap);
    </script>
</body>
</html>
